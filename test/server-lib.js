import {expect} from "chai";

import { lastPossibleMilliInBucket, getKeysWithin } from '../src/server-lib';

describe('server-lib: getKeysWithin', function() {

    it('can convert our format to a date (day)', function() {
        expect(lastPossibleMilliInBucket(['d', '00001']).toISOString()).to.eql(
            '1970-01-02T23:59:59.999Z'
        );
    });

    it('can convert our format to a date (day/hour)', function() {
        expect(lastPossibleMilliInBucket(['d00001', '11']).toISOString()).to.eql(
            '1970-01-02T11:59:59.999Z'
        );
    });

    it('can convert our format to a date (day/hour/minute)', function() {
        expect(lastPossibleMilliInBucket(['d00002-11', '22']).toISOString()).to.eql(
            '1970-01-03T11:22:59.999Z'
        );
    });

    it('can convert our format to a date (day/hour/minute/second)', function() {
        expect(lastPossibleMilliInBucket(['d00002-11:22', '33']).toISOString()).to.eql(
            '1970-01-03T11:22:33.999Z'
        );
    });

    it('will list keys', function() {

        expect(getKeysWithin(['d', '00043'])).to.eql([
            ['d00043', '00'], ['d00043', '01'], ['d00043', '02'],
            ['d00043', '03'], ['d00043', '04'], ['d00043', '05'],
            ['d00043', '06'], ['d00043', '07'], ['d00043', '08'],
            ['d00043', '09'], ['d00043', '10'], ['d00043', '11'],
            ['d00043', '12'], ['d00043', '13'], ['d00043', '14'],
            ['d00043', '15'], ['d00043', '16'], ['d00043', '17'],
            ['d00043', '18'], ['d00043', '19'], ['d00043', '20'],
            ['d00043', '21'], ['d00043', '22'], ['d00043', '23']
        ]);
        expect(getKeysWithin(['d00043', '23'])).to.eql([
            ['d00043-23', '00'], ['d00043-23', '01'], ['d00043-23', '02'],
            ['d00043-23', '03'], ['d00043-23', '04'], ['d00043-23', '05'],
            ['d00043-23', '06'], ['d00043-23', '07'], ['d00043-23', '08'],
            ['d00043-23', '09'], ['d00043-23', '10'], ['d00043-23', '11'],
            ['d00043-23', '12'], ['d00043-23', '13'], ['d00043-23', '14'],
            ['d00043-23', '15'], ['d00043-23', '16'], ['d00043-23', '17'],
            ['d00043-23', '18'], ['d00043-23', '19'], ['d00043-23', '20'],
            ['d00043-23', '21'], ['d00043-23', '22'], ['d00043-23', '23'],
            ['d00043-23', '24'], ['d00043-23', '25'], ['d00043-23', '26'],
            ['d00043-23', '27'], ['d00043-23', '28'], ['d00043-23', '29'],
            ['d00043-23', '30'], ['d00043-23', '31'], ['d00043-23', '32'],
            ['d00043-23', '33'], ['d00043-23', '34'], ['d00043-23', '35'],
            ['d00043-23', '36'], ['d00043-23', '37'], ['d00043-23', '38'],
            ['d00043-23', '39'], ['d00043-23', '40'], ['d00043-23', '41'],
            ['d00043-23', '42'], ['d00043-23', '43'], ['d00043-23', '44'],
            ['d00043-23', '45'], ['d00043-23', '46'], ['d00043-23', '47'],
            ['d00043-23', '48'], ['d00043-23', '49'], ['d00043-23', '50'],
            ['d00043-23', '51'], ['d00043-23', '52'], ['d00043-23', '53'],
            ['d00043-23', '54'], ['d00043-23', '55'], ['d00043-23', '56'],
            ['d00043-23', '57'], ['d00043-23', '58'], ['d00043-23', '59']
        ]);
        expect(getKeysWithin(['d00043-23', '11'])).to.eql([
            ['d00043-23:11', '00'], ['d00043-23:11', '01'], ['d00043-23:11', '02'],
            ['d00043-23:11', '03'], ['d00043-23:11', '04'], ['d00043-23:11', '05'],
            ['d00043-23:11', '06'], ['d00043-23:11', '07'], ['d00043-23:11', '08'],
            ['d00043-23:11', '09'], ['d00043-23:11', '10'], ['d00043-23:11', '11'],
            ['d00043-23:11', '12'], ['d00043-23:11', '13'], ['d00043-23:11', '14'],
            ['d00043-23:11', '15'], ['d00043-23:11', '16'], ['d00043-23:11', '17'],
            ['d00043-23:11', '18'], ['d00043-23:11', '19'], ['d00043-23:11', '20'],
            ['d00043-23:11', '21'], ['d00043-23:11', '22'], ['d00043-23:11', '23'],
            ['d00043-23:11', '24'], ['d00043-23:11', '25'], ['d00043-23:11', '26'],
            ['d00043-23:11', '27'], ['d00043-23:11', '28'], ['d00043-23:11', '29'],
            ['d00043-23:11', '30'], ['d00043-23:11', '31'], ['d00043-23:11', '32'],
            ['d00043-23:11', '33'], ['d00043-23:11', '34'], ['d00043-23:11', '35'],
            ['d00043-23:11', '36'], ['d00043-23:11', '37'], ['d00043-23:11', '38'],
            ['d00043-23:11', '39'], ['d00043-23:11', '40'], ['d00043-23:11', '41'],
            ['d00043-23:11', '42'], ['d00043-23:11', '43'], ['d00043-23:11', '44'],
            ['d00043-23:11', '45'], ['d00043-23:11', '46'], ['d00043-23:11', '47'],
            ['d00043-23:11', '48'], ['d00043-23:11', '49'], ['d00043-23:11', '50'],
            ['d00043-23:11', '51'], ['d00043-23:11', '52'], ['d00043-23:11', '53'],
            ['d00043-23:11', '54'], ['d00043-23:11', '55'], ['d00043-23:11', '56'],
            ['d00043-23:11', '57'], ['d00043-23:11', '58'], ['d00043-23:11', '59']
        ]);
    });

});
